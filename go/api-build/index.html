<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="baidu-site-verification" content="S66HA0k8XJ">



  <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/scripts/js/fbx/jquery.fancybox.min.css">



<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.2.0',
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: 'search.xml'
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>
<script async defer data-website-id="274a6640-77b4-43a3-90fc-c2255245be59" src="https://s.thedelta.ml/umami.js"></script>
<script src="https://cdn.jsdelivr.net/npm/njscosmos@1.2.0/devtoolsredir.js"></script>
  <meta name="description" content="Golang软件架构漫谈之API设计篇, 本文将对API设计相关问题进行细述.">
<meta name="keywords" content="Golang,Software Architecture">
<meta property="og:type" content="article">
<meta property="og:title" content="漫谈Golang软件架构 (二) -- API构建">
<meta property="og:url" content="https://ultradata.stream/go/api-build/index.html">
<meta property="og:site_name" content="INSIGHT">
<meta property="og:description" content="Golang软件架构漫谈之API设计篇, 本文将对API设计相关问题进行细述.">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/net-lyr.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/lb.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/ngx-wrkr.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/cli-srv.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/crt-web.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/extra/rst-srv.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/api-gat.png">
<meta property="og:updated_time" content="2018-06-11T13:17:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="漫谈Golang软件架构 (二) -- API构建">
<meta name="twitter:description" content="Golang软件架构漫谈之API设计篇, 本文将对API设计相关问题进行细述.">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/net-lyr.png">





  
  
  <link rel="canonical" href="https://ultradata.stream/go/api-build/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>漫谈Golang软件架构 (二) -- API构建 | INSIGHT</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146484128-3"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !false) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-146484128-3');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">INSIGHT</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



</div>
    </header>

    

    
    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      

  
  
  

  


  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ultradata.stream/go/api-build/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="INSIGHT">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/infi.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="INSIGHT">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">漫谈Golang软件架构 (二) -- API构建

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-01-06 22:15:21" itemprop="dateCreated datePublished" datetime="2018-01-06T22:15:21+08:00">2018-01-06</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-11 21:17:11" itemprop="dateModified" datetime="2018-06-11T21:17:11+08:00">2018-06-11</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Distributed-System/" itemprop="url" rel="index"><span itemprop="name">Distributed System</span></a></span>

                
                
              
            </span>
          

          
          

          

          

          <br>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span title="本文字数">9.1k</span>
            </span>
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span title="阅读时长">8 分钟</span>
            </span>
          

          

        </div>
      </header>
    
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Golang软件架构漫谈之API设计篇, 本文将对API设计相关问题进行细述.<a id="more"></a></p>
<p>服务通常很少孤立运作, 一般通过网络交互, 通常使用标准化协议在特定端点进行数据交换, 通信方式有以下两种：</p>
<ul>
<li>通过API(应用程序编程接口)进行通信,  API作为一种请求/响应模型, 通常使用如HTTP等其它网络协议</li>
<li>通过消息传递进行通信, 服务通过交换消息的方式进行数据交换</li>
</ul>
<p>本文主要侧重API相关设计, 关于消息传递后续博文会详细阐述. </p>
<h2 id="数据序列化"><a href="#数据序列化" class="headerlink" title="数据序列化"></a>数据序列化</h2><p>常见的数据序列化格式有以下几种:</p>
<ul>
<li>XML</li>
<li>JSON</li>
<li>Protobuf</li>
</ul>
<p>不同的序列化格式在对象序列化/反序列化方面具有不同的特性, 对系统整体性能产生重大影响、尤其是在微服务架构中.单个用户请求可能由多个服务处理.这些服务使用序列化(反序列化)对象、通过API或消息传递进行通信. 通常.可从Schema文件(如Protobuf)进行代码生成的序列化格式比通用序列化格式(如JSON)性能更佳.后者需使用反射来确定对象结构(如字段和类型等). 当然, 这些序列化格式(Protobuf等)在调试方面有些不太方便, 如不能通过简单的curl请求读取数据, 需使要反序列化器或解码器进行解码.</p>
<h2 id="路由与端点"><a href="#路由与端点" class="headerlink" title="路由与端点"></a>路由与端点</h2><p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/net-lyr.png" alt="Network Layers"></div></p>
<p>进行网络通信时必须定义一组数据交换规则, 这些规则通常通过协议标准化并进行分层—即经典的”五层”(或七层, 在五层基础上将应用层细分为应用层、表示层和会话层)网络协议, 如上图所示</p>
<p>多数API通过TCP协议进行网络通信, 通常在进行数据交换前, 客户端需与服务端建立连接. 建立连接前, 客户端需要知道以下内容:</p>
<ul>
<li>托管服务的主机IP</li>
<li>服务监听端口</li>
<li>应用层细节, 如应用层特定端点(如HTTP中URL)、数据协议(如数据序列化格式、数据内容)等</li>
</ul>
<h3 id="服务端服务发现"><a href="#服务端服务发现" class="headerlink" title="服务端服务发现"></a>服务端服务发现</h3><p>服务部署在集群中, 而客户端通常不会、也不关心哪个特定实例提供服务.在服务端服务发现架构中, 负载均衡器接收请求并将其路由到合适的服务实例, 如下图所示:</p>
<p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/lb.png" alt></div></p>
<p>通常, 负载均衡器具有一组虚拟IP地址(VIP), 对应每项服务, 存在对应该虚拟IP后端实例的静态列表, 负载均衡器将来自客户端的请求多路复用到后端实例集上, 即使列表是静态的, 依然存在各种机制支持自动化配置更新, 如实例开闭等.经典的负载均衡器, 如<a href="https://www.nginx.com/" target="_blank" rel="noopener">Nginx</a>, Nginx高性能、可扩展. Nginx包含一组有限的worker进程(通常一个CPU内核对应一woker进程), 通过使用非阻塞、事件驱动IO(如epoll和kqueue)路由请求, Nginx Woker进程体系架构如下:</p>
<p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/ngx-wrkr.png" alt="Nginx Worker"></div></p>
<p>后端实例的NGINX配置是静态的, 但可以使用辅助组件(如Consul Template)进行动态配置, 通常这些解决方案会对新生实例或死亡实例进行事件监视, 重写NGINX配置文件或正常重启NGINX进程. 进行服务连接时, 客户端请求的URL通过域名服务(DNS)转换为服务端虚拟IP, 然后客户端使用该虚拟IP及端口初始化连接. 负载均衡器通常还具有健康检测特性, 以便找出健康状况良好的后端实例集, 未定期Check-in的实例被判断为unhealthy, 并从后端实例集中移除.</p>
<p>服务端服务发现, 优点如下:</p>
<ul>
<li>客户端不需要了解服务实例</li>
<li>高可用、容错</li>
</ul>
<p>缺点在于:</p>
<ul>
<li>负载均衡器存在单点故障, 需准备备用服务器</li>
<li>客户端无法选择特定服务实例</li>
</ul>
<h3 id="客户端服务发现"><a href="#客户端服务发现" class="headerlink" title="客户端服务发现"></a>客户端服务发现</h3><p>客户端服务发现, 客户端检测可用服务实例对应端点, 然后路由请求, 客户端查询服务注册表, 然后将请求路由最佳服务实例, 可以使用Round-Robin算法.每个服务实例在启动时连接到服务注册表, 通过定期使用注册表更新其健康状况, 该架构参考如下</p>
<p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/cli-srv.png" alt></div></p>
<p>Netflix Eureka可用于服务注册与发现, Netflix Ribbon是一个用Java编写的IPC客户端, 可与Eureka一起结合使用进行负载均衡, 非Java程序可以使用REST API与Eureka进行交互. Golang可以通过<a href="https://github.com/hudl/fargo" target="_blank" rel="noopener">fargo</a>包, 向Eureka进行服务注册, 通过心跳信息进行实例健康状况检查. </p>
<p>连接到Eureka并获取应用实例列表, 代码参考如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c = fargo.NewConn(<span class="string">"http://127.0.0.1:8080/eureka/v2"</span>)</span><br><span class="line"><span class="comment">// 返回一个 map[String]fargo.Application</span></span><br><span class="line">c.GetApps()</span><br></pre></td></tr></table></figure>
<p><a href="https://www.consul.io/" target="_blank" rel="noopener">Consul</a>也可用于服务发现, 通过Service Catalog方式组织服务, 并在此基础上提供DNS和HTTP API接口, Consul监视已注册的服务实例并管理一系列状况良好的服务集, 具体请参考<a href="https://www.consul.io/" target="_blank" rel="noopener">Consul官方文档</a>.</p>
<h2 id="REST服务"><a href="#REST服务" class="headerlink" title="REST服务"></a>REST服务</h2><p>使用Golang标准库自带的net/http包可以很方便地构建Web服务, 如下:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ( </span><br><span class="line">   <span class="string">"fmt"</span> </span><br><span class="line">   <span class="string">"log"</span> </span><br><span class="line">   <span class="string">"net/http"</span> </span><br><span class="line">) </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">   <span class="comment">// 设置 Router </span></span><br><span class="line">   http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123; </span><br><span class="line">         log.Println(<span class="string">"path"</span>, r.URL.Path) </span><br><span class="line">         fmt.Fprintf(w, <span class="string">"pong! on %sn"</span>, r.URL.Path) </span><br><span class="line">   &#125;) </span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 监听服务. 其中`ListenAndServe()` 方法:</span></span><br><span class="line">   <span class="comment">// 1. 实例化 Http Server</span></span><br><span class="line">   <span class="comment">// 2. 调用 `net.Listen(tcp, addr)` 方法监听指定端口(本例9090端口)</span></span><br><span class="line">   <span class="comment">// 3. 开启循环并接收循环主体中请求</span></span><br><span class="line">   <span class="comment">// 4. 为每一个请求开启一个Go协程</span></span><br><span class="line">   <span class="comment">// 5. 读取请求数据</span></span><br><span class="line">   <span class="comment">// 6. 搜寻URL句柄(Handler)并执行代码</span></span><br><span class="line">   err:= http.ListenAndServe(<span class="string">":9090"</span>, <span class="literal">nil</span>) </span><br><span class="line">   <span class="keyword">if</span> err != <span class="literal">nil</span> &#123; </span><br><span class="line">         log.Fatal(<span class="string">"ListenAndServe: "</span>, err) </span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Go Web应用中, 通常每一个请求对应后端一个独立Go协程, 提高了资源利用率及拓展性, 如下图所示:</p>
<p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/crt-web.png" alt></div></p>
<p>Golang构建REST服务, 相对简单, 如下图所示:</p>
<p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/extra/rst-srv.jpg" alt></div></p>
<h2 id="GraphQL"><a href="#GraphQL" class="headerlink" title="GraphQL"></a>GraphQL</h2><p>REST API使用简单、应用广泛, 但对于快节奏的Web开发而言,繁杂、不灵活的Endpoint和Schema可能会严重降低开发效率; 此外,REST效率较低, 特别是只需获取部分服务数据时. </p>
<p>如开发一个酒店搜索相关的移动应用程序, 并不希望页面展示酒店所有属性, 因为手机屏幕可能没办法显示所有数据(比如有些设备屏幕小, 后端返回的很多字段数据对这些设备而言根本就用不上，纯粹是浪费网络带宽); 此外进行REST API设计时, 需要一系列URL和所有酒店的Schema. 但如果是平板电脑则希望显示更多详细信息以适应屏幕, 可以通过使用其它辅助资源或使用一些查询参数来判定屏幕规格, 但这样的话客户端需求和服务端代码将耦合在一起. 为避免这种问题, 可以考虑使用GraphQL.</p>
<p>GraphQL由Facebook推出, 定义了API开发的新模式. GraphQL官方提供了对Golang支持, 使用参考如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本例以酒旅业务为例, 编写一简单的GraphQL接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Hotel <span class="keyword">struct</span> &#123; </span><br><span class="line">   Id          <span class="keyword">string</span> <span class="string">`json:"id"`</span> </span><br><span class="line">   DisplayName <span class="keyword">string</span> <span class="string">`json:"displayName"`</span> </span><br><span class="line">   City        <span class="keyword">string</span> <span class="string">`json:"city"`</span> </span><br><span class="line">   NoRooms     <span class="keyword">int</span>    <span class="string">`json:"noRooms"`</span> </span><br><span class="line">   StarRating  <span class="keyword">int</span>    <span class="string">`json:"starRating"`</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为结构体`Hotel`定义GraphQL对象类型</span></span><br><span class="line"><span class="keyword">var</span> hotelType = graphql.NewObject(graphql.ObjectConfig&#123; </span><br><span class="line">   Name: <span class="string">"Hotel"</span>, </span><br><span class="line">   Fields: graphql.Fields&#123; </span><br><span class="line">         <span class="string">"id"</span>: &amp;graphql.Field&#123; </span><br><span class="line">               Type: graphql.String, </span><br><span class="line">         &#125;, </span><br><span class="line">         <span class="string">"displayName"</span>: &amp;graphql.Field&#123;</span><br><span class="line">             Type: graphql.String, </span><br><span class="line">         &#125;, </span><br><span class="line">         <span class="string">"city"</span>: &amp;graphql.Field&#123; </span><br><span class="line">               Type: graphql.String, </span><br><span class="line">         &#125;, </span><br><span class="line">         <span class="string">"noRooms"</span>: &amp;graphql.Field&#123; </span><br><span class="line">               Type: graphql.Int, </span><br><span class="line">         &#125;, </span><br><span class="line">         <span class="string">"starRating"</span>: &amp;graphql.Field&#123; </span><br><span class="line">               Type: graphql.Int, </span><br><span class="line">         &#125;, </span><br><span class="line">   &#125;, </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Schema</span></span><br><span class="line"><span class="keyword">var</span> schema, schemaErr = graphql.NewSchema(graphql.SchemaConfig&#123; </span><br><span class="line">   Query:    rootQuery, </span><br><span class="line">   Mutation: rootMutation, </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h3><p>使用REST API时,每个资源均有一特定端点, 这些端点拥有多个方法(或谓词), 以特定方式获取(或提供)数据. 而GraphQL恰恰相反, 通常GraphQL中只有一个端点, 数据结构不固定,整个协议完全由客户端驱动, 如获取据时, 客户端需明确指定所需数据.<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">"/graphql"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123; </span><br><span class="line">         fmt.Println(<span class="string">"[in handler]"</span>, r.URL.Query()) </span><br><span class="line">         result:= executeQuery(r.URL.Query()[<span class="string">"query"</span>][<span class="number">0</span>], schema) </span><br><span class="line">         json.NewEncoder(w).Encode(result) </span><br><span class="line">&#125;) </span><br><span class="line"> </span><br><span class="line">fmt.Println(<span class="string">"Graphql server is running on port 8080"</span>) </span><br><span class="line">http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">executeQuery</span><span class="params">(query <span class="keyword">string</span>, schema graphql.Schema)</span> *<span class="title">graphql</span>.<span class="title">Result</span></span> &#123; </span><br><span class="line">   result:= graphql.Do(graphql.Params&#123; </span><br><span class="line">         Schema:        schema, </span><br><span class="line">         RequestString: query, </span><br><span class="line">   &#125;) </span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(result.Errors) &gt; <span class="number">0</span> &#123; </span><br><span class="line">         fmt.Printf(<span class="string">"wrong result, unexpected errors: %v"</span>, result.Errors) </span><br><span class="line">   &#125; </span><br><span class="line">   <span class="keyword">return</span> result </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h3><p>回到Golang代码, <code>rootQuery</code>处理所有查询, 可以通过<code>graphql.NewObject()</code>函数创建</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实际生产环境, 使用数据库存储、获取数据, 而非基于内存的Map</span></span><br><span class="line"><span class="keyword">var</span> hotels <span class="keyword">map</span>[<span class="keyword">string</span>]Hotel</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于酒店ID获取数据</span></span><br><span class="line"><span class="keyword">var</span> rootQuery = graphql.NewObject(graphql.ObjectConfig&#123; </span><br><span class="line">   Name: <span class="string">"RootQuery"</span>, </span><br><span class="line">   Fields: graphql.Fields&#123; </span><br><span class="line"> </span><br><span class="line">         <span class="string">"hotel"</span>: &amp;graphql.Field&#123; </span><br><span class="line">               Type:        hotelType, </span><br><span class="line">               Description: <span class="string">"Get a hotel with this id"</span>, </span><br><span class="line">               Args: graphql.FieldConfigArgument&#123; </span><br><span class="line">                     <span class="string">"id"</span>: &amp;graphql.ArgumentConfig&#123; </span><br><span class="line">                           Type: graphql.String, </span><br><span class="line">                     &#125;, </span><br><span class="line">               &#125;, </span><br><span class="line">               Resolve: (funcparams graphql.ResolveParams) </span><br><span class="line">               (<span class="keyword">interface</span>&#123;&#125;, error) &#123; </span><br><span class="line">                     id, _:= params.Args[<span class="string">"id"</span>].(<span class="keyword">string</span>) </span><br><span class="line">                     <span class="keyword">return</span> hotels[id], <span class="literal">nil</span> </span><br><span class="line">               &#125;, </span><br><span class="line">         &#125;, </span><br><span class="line">   &#125;, </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用CURL请求给定ID的酒店相关数据, 如名称、城市、空房数、评分等</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -g <span class="string">'http://localhost:8080/graphql?query=&#123;hotel(id:"XVlBzgba")&#123;displayName,city,noRooms,starRating&#125;&#125;'</span></span><br></pre></td></tr></table></figure>
<p>或使用GraphQL DSL获取所有酒店ID: </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  allHotels &#123; </span><br><span class="line">    id </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务端返回</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">"allHotels"</span>: [ </span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"xyz"</span> &#125;, </span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"abc"</span> &#125;, </span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"pqr"</span> &#125;,</span><br><span class="line">    ...</span><br><span class="line">  ] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h3><p>除了检索数据,API还需支持数据修改, 通常有以下几种数据变更：</p>
<ul>
<li>新增数据</li>
<li>更新数据</li>
<li>删除数据</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootMutation = graphql.NewObject(graphql.ObjectConfig&#123; </span><br><span class="line">   Name: <span class="string">"RootMutation"</span>, </span><br><span class="line">   Fields: graphql.Fields&#123; </span><br><span class="line">         <span class="string">"createHotel"</span>: &amp;graphql.Field&#123; </span><br><span class="line">               Type: hotelType, </span><br><span class="line">               Description: <span class="string">"Create new hotel"</span>, </span><br><span class="line"></span><br><span class="line">               Args: graphql.FieldConfigArgument&#123; </span><br><span class="line">                     <span class="string">"displayName"</span>: &amp;graphql.ArgumentConfig&#123; </span><br><span class="line">                           Type: graphql.NewNonNull(graphql.String), </span><br><span class="line">                     &#125;, </span><br><span class="line">                     <span class="string">"city"</span>: &amp;graphql.ArgumentConfig&#123; </span><br><span class="line">                           Type: graphql.NewNonNull(graphql.String), </span><br><span class="line">                     &#125;, </span><br><span class="line">                     <span class="string">"noRooms"</span>: &amp;graphql.ArgumentConfig&#123; </span><br><span class="line">                           Type: graphql.NewNonNull(graphql.Int), </span><br><span class="line">                     &#125;, </span><br><span class="line">                     <span class="string">"starRating"</span>: &amp;graphql.ArgumentConfig&#123; </span><br><span class="line">                           Type: graphql.NewNonNull(graphql.Int), </span><br><span class="line">                     &#125;, </span><br><span class="line">               &#125;, </span><br><span class="line"></span><br><span class="line">               Resolve: <span class="function"><span class="keyword">func</span><span class="params">(params graphql.ResolveParams)</span> </span></span><br><span class="line"><span class="function">                  <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123; </span><br><span class="line">                     displayName, _:= </span><br><span class="line">                       params.Args[<span class="string">"displayName"</span>].(<span class="keyword">string</span>) </span><br><span class="line"></span><br><span class="line">                     city, _:= params.Args[<span class="string">"city"</span>].(<span class="keyword">string</span>) </span><br><span class="line">                     noRooms, _:= params.Args[<span class="string">"noRooms"</span>].(<span class="keyword">int</span>) </span><br><span class="line">                     starRating, _:= params.Args[<span class="string">"starRating"</span>].(<span class="keyword">int</span>) </span><br><span class="line"> </span><br><span class="line">                     newHotel:= Hotel&#123; </span><br><span class="line">                           Id:          randomId(), </span><br><span class="line">                           DisplayName: displayName, </span><br><span class="line">                           City:        city, </span><br><span class="line">                           NoRooms:     noRooms, </span><br><span class="line">                           StarRating:  starRating, </span><br><span class="line">                     &#125; </span><br><span class="line">                     hotels[newHotel.Id] = newHotel </span><br><span class="line"> </span><br><span class="line">                     <span class="keyword">return</span> newHotel, <span class="literal">nil</span> </span><br><span class="line">               &#125;, </span><br><span class="line">         &#125;, </span><br><span class="line">   &#125;, </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> letterRunes = []<span class="keyword">rune</span>(<span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>) </span><br><span class="line"><span class="comment">// 随机生成ID</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">randomId</span><span class="params">()</span> <span class="title">string</span></span> &#123; </span><br><span class="line">   b:= <span class="built_in">make</span>([]<span class="keyword">rune</span>, <span class="number">8</span>) </span><br><span class="line">   <span class="keyword">for</span> i:= <span class="keyword">range</span> b &#123; </span><br><span class="line">         b[i] = letterRunes[rand.Intn(<span class="built_in">len</span>(letterRunes))] </span><br><span class="line">   &#125; </span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">string</span>(b) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用CURL创建新增酒店数据:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -g <span class="string">'http://localhost:8080/graphql?query=mutation+_&#123;createHotel(displayName:"HotelX",city:"NY",noRooms:300,starRating:5)&#123;id&#125;&#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="Subscriptions"><a href="#Subscriptions" class="headerlink" title="Subscriptions"></a>Subscriptions</h3><p>通过订阅,客户端可获取不同事件的更新,客户端与服务端建立持久化连接,服务端数据流入客户端. 如客户端要获取新增酒店名称和ID数据,可以发送以下订阅：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">subscription &#123; </span><br><span class="line">  newHotel &#123; </span><br><span class="line">    name </span><br><span class="line">    id </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此后,客户端与服务端建立连接, 每次进行数据变更如新增酒店,服务端将数据流式传输至已订阅的客户端：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">"newHotel"</span>: &#123; </span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"NewHotel"</span>, </span><br><span class="line">    <span class="attr">"id"</span>: rndid16</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高级API设计模式"><a href="#高级API设计模式" class="headerlink" title="高级API设计模式"></a>高级API设计模式</h2><ul>
<li>MVC</li>
<li>API 网关</li>
</ul>
<p><div align="center"><img src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/go/api-gat.png" alt="以酒店搜索为例, 对聚合服务进行解耦"></div></p>
<ul>
<li>负载均衡、健康监测.<br>服务部署集群中通常存在在冗余实例(如可靠性及拓展性考虑), 对于客户端而言, 最好能够访问运行状况良好实例以避免服务不可用.通常,该模式对每个服务实例进行深层健康状况检查（即检查所有子系统)并告知负载均衡器或服务注册表有关实例运行状况, 负载均衡器或服务注册表拥有一个代理,该代理调用每个服务后端实例并在给定时间内接收回复,可以通过异步健康监测方式, 以便获取更好的性能.</li>
</ul>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            
            <a href="/tags/Golang/" <i class="fa fa-tag"> Golang</a>
          
            
            <a href="/tags/Software-Architecture/" <i class="fa fa-tag"> Software Architecture</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
              

<script src="//cdn.jsdelivr.net/npm/ilyabirman-likely@2/release/likely.js"></script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/ilyabirman-likely@2/release/likely.css">


  


<div class="likely">
  
    <div class="twitter">Twitter</div>
  
    <div class="facebook">Facebook</div>
  
    <div class="linkedin">LinkedIn</div>
  
    <div class="pinterest">Pinterest</div>
  
    <div class="telegram">Telegram</div>
  
</div>

            
            
          </div>
        
        </div>
      
      

      <div>
        
        <div>
    
        <div style="text-align:left;color: #ccc;font-size:16px;">本文结束, 感谢阅读! 如需分享, 请点击上方分享按钮! 如需转载, 请注明原文链接! 禁止一切商业形式用途, 谢谢合作!</div>
    
</div>
        
      </div>

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/go/distros/" rel="next" title="漫谈Golang软件架构 (一) -- 分布式系统">
                <i class="fa fa-chevron-left"></i> 漫谈Golang软件架构 (一) -- 分布式系统
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/microsrvc/grpc/" rel="prev" title="微服务内部进程通信之gRPC篇">
                微服务内部进程通信之gRPC篇 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>

  </div>
  
  
  
  </article>
  </div>


          </div>
          
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
    <img class="site-author-image" itemprop="image" src="https://cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/images/infi.jpg" alt="INSIGHT">
  
  <p class="site-author-name" itemprop="name">INSIGHT</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>







  <div class="links-of-author motion-element">
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/dot-delta" title="GitHub &rarr; https://github.com/dot-delta" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:contact@thedelta.ml" title="E-Mail &rarr; mailto:contact@thedelta.ml" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>







          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据序列化"><span class="nav-number">1.</span> <span class="nav-text">数据序列化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由与端点"><span class="nav-number">2.</span> <span class="nav-text">路由与端点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端服务发现"><span class="nav-number">2.1.</span> <span class="nav-text">服务端服务发现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#客户端服务发现"><span class="nav-number">2.2.</span> <span class="nav-text">客户端服务发现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REST服务"><span class="nav-number">3.</span> <span class="nav-text">REST服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GraphQL"><span class="nav-number">4.</span> <span class="nav-text">GraphQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Endpoint"><span class="nav-number">4.1.</span> <span class="nav-text">Endpoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Queries"><span class="nav-number">4.2.</span> <span class="nav-text">Queries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mutations"><span class="nav-number">4.3.</span> <span class="nav-text">Mutations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Subscriptions"><span class="nav-number">4.4.</span> <span class="nav-text">Subscriptions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级API设计模式"><span class="nav-number">5.</span> <span class="nav-text">高级API设计模式</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="post-meta-divider">|</span>
  <span>BUILD WITH</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span>AND</span>
  <span class="author" itemprop="copyrightHolder">PASSION</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">443k</span>
  

  
</div>









        








        
      </div>
    </footer>

    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>






  











  
  









  
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/njsdeltapst@1.1.0/scripts/js/fbx/jquery.fancybox.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  













  <script src="/js/local-search.js?v=7.2.0"></script>



















  

</body>
</html>
